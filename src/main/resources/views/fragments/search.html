<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
    <head th:fragment="head">
        <link th:href="@{/css/styles.css}" rel="stylesheet">
        <meta charset="UTF-8" />
    </head>
    <body>
        <div th:fragment="center">

            <form th:action="@{/search}" method="get">
                  <input type="text" name="keyword" id="search_keyword" placeholder="Research here">
                  <button type="submit">Go</button>
            </form>
            <li th:each="comic : ${comics}" th:text="${comic.toString()}"></li>

        </div>


        <div th:fragment="centerF">
            <p>IIIII</p>
                  <input type="text" name="keyword" id="txtSearch" placeholder="Research here">

            <ul id="comicsList"></ul>


            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script th:inline="javascript">
                /*<![CDATA[*/
                    var comics = /*[[${comics}]]*/;
                /*]]>*/

                $('#txtSearch').on('keyup', function()
                {
                    var value = $(this).val();
                    console.log("Value = " + value);

                    var data = FilterFunction(value, comics);

                    if (value != '')
                        rebuildTable(data);
                    else
                        document.getElementById('comicList').innerHTML = '';
                });

                function FilterFunction(value, data)
                {
                    var filteredData = [];
                    for ( var i = 0; i<data.length; i++)
                    {
                        value = value.toLowerCase();

                        //var au = data[i].author.toLowerCase();
                        var ti = data[i].title.toLowerCase();

                        if (/*au.includes(value) ||*/ ti.includes(value))
                        {
                            filteredData.push(data[i])
                        }
                    }

                    return filteredData;
                }

                function rebuildTable(data)
                {
                    var table = document.getElementById('comicsList');
                    table.innerHTML = '';
                    for (var i = 0; i <data.length; i++)
                    {
                        var row = `<li>${data[i].toString()}</li>`
                        table.innerHTML += row;
                    }
                }
            </script>

        </div>

        <div th:fragment="centerH">
            <h1>Search Page test</h1>
            <form th:action="@{/searchPage/1}" method="get">
                <input type="text" name="keyword" id="search_keyword" placeholder="Research here">
                <!--<input th:unless="${keyword_search == null}"  type="text" name="keyword" id="search_keyword" placeholder="Research here" th:value="${keyword_search}">-->
                <button type="submit">Go</button>
          </form>
          <li th:each="comic : ${comics}" th:text="${comic.toString()}"></li>

          <li th:class="${currentPage < totalPages ? 'page-item' : 'page-item_disabled'} ">
              <a th:if="${keyword_search != null}"th:href="@{'/searchPage/' + ${currentPage + 1}(keyword = ${keyword_search})}">Suivant</a>
          </li>
        </div>
    </body>
</html>